# STEP7: 更なるStretch課題

## 1. (復習)APIにカテゴリー一覧を返すエンドポイントを追加する
ここでは、[3-8. (Optional) カテゴリの情報を別のテーブルに移す](https://github.com/mercari-build/mercari-build-training-2022/blob/main/document/step3.ja.md)を完了している前提となります。
カテゴリー一覧を返すエンドポイントを作りましょう。

```
curl -X GET http://127.0.0.1:9000/categories
{"categories":[{"id":1,"name":"fashion"},{"id":2,"name":"food"}]}
```
## 2. 新規商品追加時に、カテゴリーをドロップダウンメニューで選択できるようにする
現状では文字を入力する方式でカテゴリーを選択していますが、この方法はある懸念点があります。

それは、**表記ゆれにより似たようなカテゴリーが乱立する可能性が高い**ということです。
例えば、同じ「ジャケット」を出品するにしてもファッション、fashion、衣類...と様々な
カテゴリーが考えられます。この点を考慮すると、ユーザーがどのようなカテゴリーを入力するかは予測不可能です。

従って、カテゴリーを選択するという作業は**サービス側**がカテゴリー一覧をドロップダウンメニューで提示し、それを**ユーザー側**が選択する形が好ましいと考えられます。


**:book: Reference**
* [\<select>: HTML 選択要素](https://developer.mozilla.org/ja/docs/Web/HTML/Element/select)
* [\<option>: HTML 選択肢要素](https://developer.mozilla.org/ja/docs/Web/HTML/Element/option)

## 3. フロントエンドでList this itemボタンを押した際に、エラーを表示できるようにする
現在はList this itemボタンを押すと、入力状態を一切考慮せずバックエンドにPOSTリクエストを投げている状態です。しかし、ユーザーの入力に以下のような不備がある場合が考えられます。

- 商品名が入力されていない
    - 現状のコードではエラーが表示されるようになっていました
- カテゴリーが選択されていない
- 拡張子がjpg以外のファイルがアップロードされている
    - 拡張子すらない(ピリオドがない)ファイルがアップロードされている可能性もあります
- 画像がアップロードされていない
- 画像が２枚以上アップロードされている
    - 現状のコードではmultiple属性がないため、1枚しかアップロードできないようになっていました

このような入力状態の場合、ユーザーにエラーメッセージを提示して正しい入力状態に変更してもらいましょう。
これにより、**開発者の想定外のデータがPOSTされ、それに伴いバックエンドでエラーが発生する**という事態を防ぐことができます。

## 4. バックエンドのAPIのエラーハンドリング
既に行った方もいらっしゃるかもしれませんが、今一度`main.py`、`main.go`を見直してエラーハンドリングを行いましょう。メンターさんのお話を伺って、以下の点を意識することが大切だと思いました。

- ユーザー目線
    - 適切なHTTPステータスコードを返す
        - 200は成功の時だけ返しましょう
    - 適切なエラーメッセージにする
        - ユーザーに表示するメッセージなので、必要以上に内部情報(どのようなファイルがあるかなど)を開示しないようにしましょう。攻撃のヒントを与えてしまうかもしれません
- 開発者目線
    - ログに適切なエラーメッセージを残す
        - このログは開発者が見るものなので、詳細な情報を残しましょう。そうすることで、エラーの原因が分かりやすくなります

**:book: Reference**
* [RESTful APIのエラー設計](https://qiita.com/NagaokaKenichi/items/20825ae9256d9f4c6f35)
* [WebAPIでエラーをどう表現すべき？15のサービスを調査してみた](https://qiita.com/suin/items/f7ac4de914e9f3f35884)
## 5. フロントエンドのレスポンシブ対応
現在では、様々なデバイス(PC、スマートフォン、タブレットなど)が存在します。各デバイスの画面の大きさに合わせた表示をしましょう。

**:book: Reference**
* [レスポンシブデザイン](https://developer.mozilla.org/ja/docs/Learn/CSS/CSS_layout/Responsive_Design)
## 6. WEBサイトにおける画像の取り扱いについて考えてみる
Googleが推奨しているWebサイトのデータ容量は1.6MBです(3G回線が基準になっています)。ユーザーがアップロードした画像をそのまま保存していけば、1.6MBは簡単に超えてしまいそうです。あくまで1.6MBという数字は目安ですが、画像の軽量化を図るに越したことはないと思います。そこで、画像のリサイズや圧縮を行うことでデータ容量を減らしてみましょう。
また、local環境でも動作する[Lighthouse](https://www.npmjs.com/package/lighthouse)を使用して、現在のサイトのスコアを確認してみましょう。スコアを高くするにはどのような方法が考えられるでしょうか。

**:book: Reference**
* [Avoid enormous network payloads](https://web.dev/total-byte-weight/)
